<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeniusPost AI</title>
    <link rel="stylesheet" href="../static/index.css"> 
    <style>
        /* Add responsive table styles to fix overflow issue */
        .post-preview {
            overflow-x: auto; /* Enable horizontal scrolling if needed */
        }
        
        .post-content table {
            width: 100%;
            max-width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.9rem; /* Slightly smaller font for better fit */
        }
        
        .post-content th,
        .post-content td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
            word-wrap: break-word;
            max-width: 150px; /* Limit cell width */
            overflow-wrap: break-word;
        }
        
        .post-content th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: #fca5a5;
        }
        
        .post-content td {
            background: rgba(255, 255, 255, 0.02);
        }
        
        /* For very large tables, make them scrollable */
        .post-content .table-wrapper {
            overflow-x: auto;
            margin: 1rem 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Responsive behavior for smaller screens */
        @media (max-width: 768px) {
            .post-content table {
                font-size: 0.8rem;
            }
            
            .post-content th,
            .post-content td {
                padding: 6px 8px;
                max-width: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation"></div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="logo"> GeniusPost AI</h1>
            <p class="tagline">Transform your ideas into engaging LinkedIn posts with AI magic</p>
            {% if current_user.is_authenticated %}
                <div class="profile-container">
                    <img
                    src="{{ current_user.avatar_url }}"
                    alt="Profile"
                    id="profileIcon"
                    class="profile-icon"
                    />
                    <div id="profileCard" class="profile-card">
                    <div class="profile-card-header">
                        Welcome, {{ current_user.name }}
                    </div>
                    <a href="{{ url_for('logout') }}" class="profile-logout-btn">
                        Logout
                    </a>
                    </div>
                </div>
{% endif %}

        </div>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Input Section -->
            <!-- <div class="input-section">
                <h2 class="section-title">Create Your Post</h2>
                <textarea 
                    class="prompt-input" 
                    id="promptInput"
                    placeholder="Describe your LinkedIn post idea... 

Examples:
‚Ä¢ Write about the importance of continuous learning in tech
‚Ä¢ Share insights about remote work productivity
‚Ä¢ Discuss AI trends in marketing
‚Ä¢ Create a motivational post about career growth"
                ></textarea>
                
                <div class="post-options">
                    <button class="option-btn active" data-format="square">
                        üì± Content
                    </button>
                    <button class="option-btn" data-format="vertical">
                        üìã Flowchart
                    </button>
                </div>
                
                <button class="generate-btn" id="generateBtn">
                    <span class="btn-text">Generate AI Content</span>
                    <div class="loading-spinner" id="loadingSpinner"></div>
                </button>
            </div> -->
            <div class="input-section">
                <h2 class="section-title">Create Your Post</h2>
                <textarea 
                    class="prompt-input" 
                    id="promptInput"
                    placeholder=""
                ></textarea>
                
                <button class="generate-btn" id="generateBtn">
                    <span class="btn-text">Generate AI Content</span>
                    <div class="loading-spinner" id="loadingSpinner"></div>
                </button>
                </div>

            <!-- Benefits Section -->
            <div class="benefits-section">
                <h2 class="section-title">Why Choose AI Content?</h2>
                
                <div class="benefit-item">
                    <div class="benefit-icon">‚ö°</div>
                    <div class="benefit-text">
                        <div class="benefit-title">Lightning Fast</div>
                        <div class="benefit-desc">Generate professional content in seconds</div>
                    </div>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">üéØ</div>
                    <div class="benefit-text">
                        <div class="benefit-title">Engagement Optimized</div>
                        <div class="benefit-desc">Content designed for maximum LinkedIn reach</div>
                    </div>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">‚ú®</div>
                    <div class="benefit-text">
                        <div class="benefit-title">Professional Quality</div>
                        <div class="benefit-desc">AI-powered writing that sounds human</div>
                    </div>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">üîÑ</div>
                    <div class="benefit-text">
                        <div class="benefit-title">Fully Editable</div>
                        <div class="benefit-desc">Customize and refine before posting</div>
                    </div>
                </div>

                <div class="benefit-item">
                    <div class="benefit-icon">üí°</div>
                    <div class="benefit-text">
                        <div class="benefit-title">Creative Ideas</div>
                        <div class="benefit-desc">Never run out of content inspiration</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="output-section" id="outputSection">
            <h2 class="section-title">Your Generated Content</h2>
            <div class="post-preview">
                <!-- <textarea class="post-content" id="postContent" placeholder="Your generated content will appear here..."></textarea> -->
                <div class="post-content" id="postContent" contenteditable="true" spellcheck="false"></div>

            </div>
            <div class="post-actions">
                <button id="infographicBtn" class="action-btn primary" onclick="copyToClipboard()">üìã Infographic</button>
                <button class="action-btn" id="exportPdfBtn">üìÑ Export PDF</button>
                <!-- ‚îÄ‚îÄ INSERT IMAGE BUTTON HERE ‚îÄ‚îÄ -->
                <button class="action-btn" id="insertImageBtn">üñºÔ∏è Insert Image</button>
                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <button id="regenerateBtn" class="action-btn" onclick="regenerateContent()">üîÑ Regenerate</button>
                <button id="clearBtn" class="action-btn" onclick="clearContent()">üóëÔ∏è Clear</button>
            </div>
            <!-- ‚îÄ‚îÄ HIDDEN FILE INPUT FOR IMAGE UPLOAD ‚îÄ‚îÄ -->
            <input type="file" id="imageInput" accept="image/*" style="display: none;" />
            <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        </div>
    </div>
    <!-- quill library for html editor  -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- html2canvas for image export -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Global variables
        let selectedFormat = 'square';
        let currentPrompt = '';

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Post format selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedFormat = this.dataset.format;
                });
            });

            // Generate button
            document.getElementById('generateBtn').addEventListener('click', generateContent);

            // Enter key in textarea
            document.getElementById('promptInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    generateContent();
                }
            });
        }

        // Generate content function
        async function generateContent() {
            const promptInput = document.getElementById('promptInput');
            const generateBtn = document.getElementById('generateBtn');
            const btnText = generateBtn.querySelector('.btn-text');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const outputSection = document.getElementById('outputSection');
            const postContent = document.getElementById('postContent');

            currentPrompt = promptInput.value.trim();

            if (!currentPrompt) {
                promptInput.focus();
                promptInput.style.borderColor = '#ff6b6b';
                setTimeout(() => {
                    promptInput.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                }, 2000);
                return;
            }

            // Start loading state
            generateBtn.classList.add('loading');
            btnText.style.display = 'none';
            loadingSpinner.style.display = 'block';

            try {
                // Simulate API call with realistic delay 
                await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 2000));

                const response = await mockApiCall(currentPrompt);
                const markdown_parsed_to_html = marked.parse(response.content);
                
                // Process the HTML to wrap large tables for better responsiveness
                const processedHtml = processTablesForResponsiveness(markdown_parsed_to_html);
                
                postContent.innerHTML = processedHtml;
                outputSection.classList.add('show');
                outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                console.error('Error generating content:', error);
                alert('Failed to generate content. Please try again.');
            } finally {
                // End loading state
                generateBtn.classList.remove('loading');
                btnText.style.display = 'block';
                loadingSpinner.style.display = 'none';
            }
        }

        // Function to process tables for better responsiveness
        function processTablesForResponsiveness(html) {
            // Create a temporary div to parse the HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // Find all tables and wrap them if they're large
            const tables = tempDiv.querySelectorAll('table');
            tables.forEach(table => {
                const rows = table.querySelectorAll('tr');
                const cols = rows[0] ? rows[0].querySelectorAll('td, th').length : 0;
                
                // If table has many columns (>6) or many rows (>8), wrap it for scrolling
                if (cols > 6 || rows.length > 8) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'table-wrapper';
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                }
            });
            
            return tempDiv.innerHTML;
        }

        async function mockApiCall(prompt) {
            try {
                const res = await fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
                });

                if (!res.ok) {
                // network/server error (e.g. 500)
                const errText = await res.text();
                throw new Error(`Server responded ${res.status}: ${errText}`);
                }

                const data = await res.json();
                if (data.error) {
                // API-level error
                throw new Error(data.error);
                }

                // Return whatever you need downstream‚Äîhere, the GPT raw result:
                return { content: data.result };
            } catch (err) {
                // Notify the user
                alert('Error: ' + err.message);

                // Re-throw if you want callers to catch it
                throw err;
            }
            }

            async function copyToClipboard() {
                const preview = document.querySelector('.post-preview');
                if (!preview) {
                    return alert('Nothing to capture!');
                }
                //////////////////////////
                // ‚îÄ‚îÄ ‚ë† TEMPORARILY ADD WATERMARK ‚îÄ‚îÄ
                const wm = document.createElement('div');
                wm.className = 'watermark';
                wm.innerText = 'GeniusPost AI';
                preview.appendChild(wm);
                //////////////////////////

                // 1. Override heading gradients as before
                const headings = preview.querySelectorAll('h1, h2, h3, h4, h5, h6');
                headings.forEach(h => {
                    h.dataset.origBg    = h.style.background;
                    h.dataset.origClip  = h.style.webkitBackgroundClip;
                    h.dataset.origColor = h.style.color;

                    h.style.background           = 'none';
                    h.style.webkitBackgroundClip = 'unset';
                    h.style.color                = '#fca5a5';
                });

                // 2. Temporarily override the preview background
                const origBg = preview.style.background;
                preview.style.background = 'linear-gradient(135deg, #2a2a3d, #1e1e2f)'; // dark purple‚Äìbluish

                // 3. Capture the full preview box
                try {
                    const canvas = await html2canvas(preview, {
                    backgroundColor: null, // let the inline style show
                    scale: 2
                    });
                    canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'linkedin-post.png';
                    a.click();
                    URL.revokeObjectURL(url);
                    });
                } catch (err) {
                    console.error('Snapshot failed:', err);
                    alert('Unable to save snapshot.');
                }

                // 4. Restore original heading and preview background styles
                headings.forEach(h => {
                    h.style.background           = h.dataset.origBg;
                    h.style.webkitBackgroundClip = h.dataset.origClip;
                    h.style.color                = h.dataset.origColor;
                    delete h.dataset.origBg;
                    delete h.dataset.origClip;
                    delete h.dataset.origColor;
                });
                preview.style.background = origBg;
                // ‚îÄ‚îÄ ‚ë£ REMOVE WATERMARK ‚îÄ‚îÄ
                preview.removeChild(wm);
                }
// /////////////////////////////// PDF ////////////////////////////////////////////////////////////
        
            // document.getElementById('exportPdfBtn').addEventListener('click', async () => {
            // const preview = document.querySelector('.post-preview');
            // if (!preview) return alert('Nothing to export!');
            // // ‚îÄ‚îÄ ‚ë† TEMPORARILY ADD WATERMARK ‚îÄ‚îÄ
            // const wm = document.createElement('div');
            // wm.className = 'watermark';
            // wm.innerText = 'GeniusPost AI';
            // preview.appendChild(wm);

            // // Temporarily override heading gradients (same as PNG fix)
            // const headings = preview.querySelectorAll('h1, h2, h3, h4, h5, h6');
            // headings.forEach(h => {
            //     h.dataset.origBg    = h.style.background;
            //     h.dataset.origClip  = h.style.webkitBackgroundClip;
            //     h.dataset.origColor = h.style.color;
            //     h.style.background           = 'none';
            //     h.style.webkitBackgroundClip = 'unset';
            //     h.style.color                = '#fca5a5';
            // });

            // // Temporarily darken background if needed
            // const origBg = preview.style.background;
            // preview.style.background = 'linear-gradient(135deg, #2a2a3d, #1e1e2f)';

            // try {
            //     // 1. Render the entire preview to one tall canvas
            //     const canvas = await html2canvas(preview, { backgroundColor: null, scale: 2 });
                


            //     // 2. Export as PNG for perfect fidelity
            //     const imgData = canvas.toDataURL('image/png');

            //     // --- NEW: crop the tall canvas into A4‚Äêsized page slices ---
            //     const { jsPDF } = window.jspdf;
            //     const pdf = new jsPDF({ unit: 'px', format: 'a4' });
            //     const pdfW = pdf.internal.pageSize.getWidth();
            //     const pdfH = pdf.internal.pageSize.getHeight();

            //     // Compute the ratio of canvas‚ÜíPDF widths
            //     const canvasW = canvas.width;
            //     const canvasH = canvas.height;
            //     const scale = (pdfW - 40) / canvasW; 
            //     const pageCanvasH = Math.floor(pdfH / scale);

            //     let renderedH = 0;
            //     while (renderedH < canvasH) {
            //         // 5. Fill entire page with neon purple (or black). 
            //         //    RGB for neon‚Äêpurple (#9f7aea) = (159, 122, 234).
            //         pdf.setFillColor(159, 122, 234);
            //         pdf.rect(0, 0, pdfW, pdfH, 'F');
            //     // Create a temp canvas for this page
            //     const tempCanvas = document.createElement('canvas');
            //     tempCanvas.width = canvasW;
            //     tempCanvas.height = Math.min(pageCanvasH, canvasH - renderedH);
            //     const tCtx = tempCanvas.getContext('2d');
                
            //     // Draw the slice
            //     tCtx.drawImage(
            //         canvas,
            //         0, renderedH,               // src x, y
            //         canvasW, tempCanvas.height, // src w, h
            //         0, 0,
            //         canvasW, tempCanvas.height  // dst w, h
            //     );
                
            //     // Add to PDF
            //     const sliceData = tempCanvas.toDataURL('image/jpeg', 0.8);
            //     // pdf.addImage(sliceData, 'PNG', 20, 20, canvasW * scale, tempCanvas.height * scale);
            //     pdf.addImage(sliceData, 'JPEG', 20, 20, canvasW * scale, tempCanvas.height * scale);
            //     renderedH += pageCanvasH;
            //     if (renderedH < canvasH) pdf.addPage();
            //     }

            //     pdf.save('linkedin-post.pdf');

            // } catch (e) {
            //     console.error('PDF export failed:', e);
            //     alert('Could not export multi-page PDF.');
            // } finally {
            //     // ‚îÄ‚îÄ ‚ë£ REMOVE WATERMARK ‚îÄ‚îÄ
            //     preview.removeChild(wm);
            //     // Restore heading and preview bg
            //     headings.forEach(h => {
            //     h.style.background           = h.dataset.origBg;
            //     h.style.webkitBackgroundClip = h.dataset.origClip;
            //     h.style.color                = h.dataset.origColor;
            //     delete h.dataset.origBg;
            //     delete h.dataset.origClip;
            //     delete h.dataset.origColor;
            //     });
            //     preview.style.background = origBg;
            // }
            // });
            document.getElementById('exportPdfBtn').addEventListener('click', async () => {
                const preview = document.querySelector('.post-preview');
                if (!preview) return alert('Nothing to export!');

                try {
                    // ‚îÄ‚îÄ ‚ë† CREATE PRINT-OPTIMIZED CLONE ‚îÄ‚îÄ
                    const printContainer = document.createElement('div');
                    printContainer.style.cssText = `
                        position: absolute;
                        top: -9999px;
                        left: -9999px;
                        width: 210mm;
                        background: white;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        color: #333;
                        line-height: 1.6;
                        padding: 20mm;
                        box-sizing: border-box;
                    `;

                    // Clone the preview content
                    const clonedContent = preview.cloneNode(true);
                    
                    // ‚îÄ‚îÄ ‚ë° ADD WATERMARK TO CLONE ‚îÄ‚îÄ
                    const wm = document.createElement('div');
                    wm.style.cssText = `
                        position: fixed;
                        top: 10mm;
                        right: 10mm;
                        font-size: 12px;
                        color: #999;
                        z-index: 1000;
                    `;
                    wm.innerText = 'GeniusPost AI';
                    clonedContent.appendChild(wm);

                    // ‚îÄ‚îÄ ‚ë¢ ADD PRINT-SPECIFIC STYLES ‚îÄ‚îÄ
                    const printStyles = document.createElement('style');
                    printStyles.id = 'pdf-export-styles';
                    printStyles.textContent = `
                        @media print {
                            * {
                                -webkit-print-color-adjust: exact !important;
                                color-adjust: exact !important;
                                print-color-adjust: exact !important;
                            }
                            
                            body {
                                margin: 0 !important;
                                padding: 0 !important;
                                background: white !important;
                            }
                            
                            /* Prevent content chopping */
                            h1, h2, h3, h4, h5, h6 {
                                page-break-after: avoid !important;
                                break-after: avoid !important;
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                color: #e11d48 !important;
                                background: none !important;
                                -webkit-background-clip: unset !important;
                            }
                            
                            p {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                orphans: 3 !important;
                                widows: 3 !important;
                                margin-bottom: 12px !important;
                            }
                            
                            table {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                page-break-before: auto !important;
                                page-break-after: auto !important;
                                border-collapse: collapse !important;
                                width: 100% !important;
                                margin-bottom: 20px !important;
                            }
                            
                            tr {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                            }
                            
                            td, th {
                                padding: 8px !important;
                                border: 1px solid #ddd !important;
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                            }
                            
                            pre, code, .code-block {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                background: #f5f5f5 !important;
                                padding: 12px !important;
                                border-radius: 4px !important;
                                font-family: 'Courier New', monospace !important;
                                font-size: 12px !important;
                                margin-bottom: 16px !important;
                                white-space: pre-wrap !important;
                                word-wrap: break-word !important;
                            }
                            
                            blockquote {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                border-left: 4px solid #e11d48 !important;
                                padding-left: 16px !important;
                                margin: 16px 0 !important;
                                font-style: italic !important;
                                background: #f9f9f9 !important;
                            }
                            
                            img {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                max-width: 100% !important;
                                height: auto !important;
                                margin-bottom: 16px !important;
                            }
                            
                            ul, ol {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                margin-bottom: 16px !important;
                            }
                            
                            li {
                                page-break-inside: avoid !important;
                                break-inside: avoid !important;
                                margin-bottom: 4px !important;
                            }
                            
                            /* Ensure good spacing */
                            .post-preview > * {
                                margin-bottom: 16px !important;
                            }
                            
                            @page {
                                size: A4;
                                margin: 20mm;
                            }
                        }
                    `;

                    // ‚îÄ‚îÄ ‚ë£ SETUP PRINT ENVIRONMENT ‚îÄ‚îÄ
                    document.head.appendChild(printStyles);
                    printContainer.appendChild(clonedContent);
                    document.body.appendChild(printContainer);

                    // ‚îÄ‚îÄ ‚ë§ CREATE PRINT WINDOW ‚îÄ‚îÄ
                    const printWindow = window.open('', '_blank', 'width=800,height=600');
                    
                    if (!printWindow) {
                        throw new Error('Popup blocked. Please allow popups for this site.');
                    }
                    
                    printWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="UTF-8">
                            <title>LinkedIn Post Export - GeniusPost AI</title>
                            <style>
                                ${printStyles.textContent}
                                
                                /* Additional styles for print window */
                                body {
                                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                    line-height: 1.6;
                                    color: #333;
                                    max-width: 100%;
                                    margin: 0;
                                    padding: 20px;
                                }
                                
                                /* Screen styles for preview */
                                @media screen {
                                    body {
                                        background: #f5f5f5;
                                        padding: 40px 20px;
                                    }
                                    
                                    .content-wrapper {
                                        background: white;
                                        padding: 40px;
                                        border-radius: 8px;
                                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                        max-width: 210mm;
                                        margin: 0 auto;
                                    }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="content-wrapper">
                                ${clonedContent.innerHTML}
                            </div>
                            <script>
                                // Auto-print after content loads
                                window.onload = function() {
                                    setTimeout(function() {
                                        window.print();
                                    }, 1000);
                                };
                                
                                // Close window after printing (optional)
                                window.onafterprint = function() {
                                    setTimeout(function() {
                                        window.close();
                                    }, 1000);
                                };
                            </script>
                        </body>
                        </html>
                    `);
                    
                    printWindow.document.close();

                    // Show success message
                    alert('Print window opened! Please select "Save as PDF" when the print dialog appears.');

                } catch (e) {
                    console.error('PDF export failed:', e);
                    alert('Could not export PDF: ' + e.message);
                } finally {
                    // ‚îÄ‚îÄ ‚ë• CLEANUP ‚îÄ‚îÄ
                    setTimeout(() => {
                        // Remove temporary elements
                        const printStyles = document.getElementById('pdf-export-styles');
                        if (printStyles) {
                            document.head.removeChild(printStyles);
                        }
                        
                        const printContainer = document.querySelector('div[style*="position: absolute"][style*="top: -9999px"]');
                        if (printContainer) {
                            document.body.removeChild(printContainer);
                        }
                    }, 3000);
                }
            });

            

        // ///////////////////////////////////////////////////////////////////////////////////////
                function regenerateContent() {
                    if (currentPrompt) {
                        generateContent();
                    }
                }

                function clearContent() {
                    document.getElementById('postContent').value = '';
                    document.getElementById('outputSection').classList.remove('show');
                    document.getElementById('promptInput').value = '';
                    currentPrompt = '';
                }

                // Initialize everything when DOM loads
                document.addEventListener('DOMContentLoaded', function() {
                    createParticles();
                    initializeEventListeners();
                });

                // Add some interactive hover effects
                document.addEventListener('mousemove', function(e) {
                    const particles = document.querySelectorAll('.particle');
                    particles.forEach(particle => {
                        const speed = Math.random() * 2 + 1;
                        const x = (e.clientX * speed) / 100;
                        const y = (e.clientY * speed) / 100;
                        
                        particle.style.transform = `translateX(${x}px) translateY(${y}px)`;
                    });
                });

    ////////////////////////////////////Image/////////////////////////////////
        document
      .getElementById('insertImageBtn')
      .addEventListener('click', () => {
        document.getElementById('imageInput').click();
    });

    document
      .getElementById('imageInput')
      .addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        if (!file.type.startsWith('image/')) {
          alert('Please select an image file.');
          return;
        }
        const reader = new FileReader();
        reader.onload = () => {
          const imgDataUrl = reader.result;
          const img = document.createElement('img');
          img.src = imgDataUrl;
          img.style.maxWidth = '100%';
          img.style.margin = '1rem 0';
          img.style.borderRadius = '0.75rem';
          img.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
          
          const postDiv = document.getElementById('postContent');
          postDiv.appendChild(img);
          postDiv.appendChild(document.createElement('br'));
          event.target.value = '';
        };
        reader.readAsDataURL(file);
    });

    document.addEventListener('DOMContentLoaded', () => {
    const icon = document.getElementById('profileIcon');
    const card = document.getElementById('profileCard');
    if (!icon || !card) return;

    icon.addEventListener('click', e => {
      e.stopPropagation();
      card.classList.toggle('visible');
    });

    // click outside closes the card
    document.addEventListener('click', () => {
      card.classList.remove('visible');
    });

    // prevent clicks inside the card from bubbling out
    card.addEventListener('click', e => e.stopPropagation());
  });

  function trackAction(action) {
    fetch("/track_action", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",    // so Flask-Login cookie is sent
        body: JSON.stringify({ action })
    }).catch(console.error);
    }

    // map IDs ‚Üí action strings
    const mapping = {
    generateBtn:    "generate_ai_content",
    infographicBtn: "infographic",
    exportPdfBtn:   "export_pdf",
    insertImageBtn:   "insert_image",
    regenerateBtn:  "regenerate",
    clearBtn:       "clear",
    };

    Object.entries(mapping).forEach(([id, action]) => {
    const btn = document.getElementById(id);
    if (btn) btn.addEventListener("click", () => trackAction(action));
    });
    // ////////////////// Dynamic text input placeholder //////////////////////

    document.addEventListener('DOMContentLoaded', () => {
    const textarea = document.getElementById('promptInput');
    const samples = [
      'Write a short engaging post on ML systems using headings, subheadings. ',
      'Generate an infographic on finance with proper tables.',
      'Write a carousel with 10 code snippets covering entire MCP workflow. ',
      'Create a thought leadership post on Real estate, Leave [2-3] sentence blank for my insights.',
      'Write, edit, style, format, add image and download stunning infographics and Carousels.'
    ];
    let loopTimer, charTimer;
    let sampleIdx = 0, charIdx = 0, deleting = false;

    function startTyping() {
      const current = samples[sampleIdx];
      // type or delete one character
      if (!deleting) {
        textarea.placeholder = current.slice(0, ++charIdx);
      } else {
        textarea.placeholder = current.slice(0, charIdx--);
      }

      // schedule next char
      const delay = deleting ? 20 : 60;
      charTimer = setTimeout(() => {
        // switch to deleting once fully typed
        if (!deleting && charIdx === current.length) {
          deleting = true;
          clearTimeout(charTimer);
          loopTimer = setTimeout(startTyping, 1000); // pause before delete
        }
        // move to next sample once fully deleted
        else if (deleting && charIdx === 0) {
          deleting = false;
          sampleIdx = (sampleIdx + 1) % samples.length;
          clearTimeout(charTimer);
          loopTimer = setTimeout(startTyping, 500); // pause before next type
        }
        else {
          startTyping();
        }
      }, delay);
    }

    // kick off the loop
    loopTimer = setTimeout(startTyping, 500);

    // when user focuses, stop all timers and clear placeholder
    textarea.addEventListener('focus', () => {
      clearTimeout(loopTimer);
      clearTimeout(charTimer);
      textarea.placeholder = '';
    });
  });

    </script>
</body>
</html>